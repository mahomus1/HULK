<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weekly Schedule - Mizzou GI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root {
            --mizzou-black: #000000;
            --mizzou-gold: #FFB612;
            --mizzou-gold-dark: #C99700;
            --mizzou-gray: #f8f8f8;
            --mizzou-gray-row: #f2f2f2;
            --mizzou-hover-gold: #FFF8E1;
        }
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background-color: var(--mizzou-gray);
        }
        .mizzou-header {
            background-color: var(--mizzou-black);
            color: var(--mizzou-gold);
            padding: 0.75rem;
            margin-bottom: 1rem;
            text-align: center;
        }
        .controls {
            background-color: #ffffff;
            padding: 0.75rem;
            margin-bottom: 0.75rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        select {
            padding: 0.375rem 0.5rem;
            font-size: 0.875rem;
            border-radius: 0.25rem;
            border: 1px solid #d1d5db;
            width: 100%;
        }
        .table-container {
            background-color: white;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }
        
        /* Base table styles */
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        /* Desktop styles */
        @media (min-width: 769px) {
            th, td {
                padding: 0.5rem;
                text-align: left;
                border-bottom: 1px solid #e5e7eb;
                font-size: 0.875rem;
            }
            .pgy-badge {
                background-color: var(--mizzou-gold-dark);
                color: var(--mizzou-black);
                padding: 0.125rem 0.375rem;
                border-radius: 0.25rem;
                font-size: 0.75rem;
                margin-left: 0.5rem;
            }
        }
        
        /* Mobile compact styles */
        @media (max-width: 450px) {
            .mizzou-header h1 { font-size: 1.25rem; }
            .mizzou-header p { font-size: 0.75rem; }
            
            table {
                min-width: 420px; /* Accommodates full rotation names except Ori/üéÜ */
            }
            
            th, td {
                padding: 0.125rem 0.25rem;
                font-size: 0.625rem;
                border-bottom: 1px solid #e5e7eb;
                vertical-align: middle;
            }
            
            /* Sticky header and first column */
            thead th {
                position: sticky;
                top: 0;
                background-color: var(--mizzou-black);
                color: var(--mizzou-gold);
                z-index: 10;
                font-weight: 600;
            }
            
            tbody td:first-child,
            thead th:first-child {
                position: sticky;
                left: 0;
                background-color: white;
                z-index: 5;
                font-weight: 600;
                white-space: nowrap;
                max-width: 60px;
                overflow: hidden;
                text-overflow: ellipsis;
            }
            
            thead th:first-child {
                background-color: var(--mizzou-black);
                z-index: 11;
            }
            
            /* Ultra compact cells */
            .shift-cell {
                text-align: center;
                line-height: 1.1;
                position: relative;
            }

            .am-shift, .pm-shift {
                display: flex;
                align-items: center;
                justify-content: center;
                padding: 0.0625rem 0.125rem;
                font-size: 0.5rem;
                font-weight: 500;
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
                gap: 0.0625rem;
            }

            /* AM/PM indicators */
            .time-indicator {
                font-size: 0.425rem;
                opacity: 0.75;
                margin-right: 0.0625rem;
                font-weight: 400;
                flex-shrink: 0;
                line-height: 1;
                vertical-align: middle;
                display: inline-block;
            }

            .am-indicator {
                color: #f59e0b; /* Amber/gold for sun */
                filter: brightness(1.1);
            }

            .pm-indicator {
                color: #6366f1; /* Indigo/blue for moon */
                filter: brightness(0.9);
            }
            
            .shift-divider {
                height: 1px;
                background: #e5e7eb;
                margin: 0.0625rem 0;
                opacity: 0.5;
            }
            
            /* PGY indicator - inline and tiny */
            .pgy {
                font-size: 0.5rem;
                color: #6b7280;
                font-weight: normal;
            }
            
            /* Day headers */
            .day-header {
                text-align: center;
                font-size: 0.625rem;
                padding: 0.25rem 0.125rem;
            }
            
            .date-label {
                font-size: 0.5rem;
                font-weight: normal;
                opacity: 0.8;
            }
            
            /* Day columns minimum width */
            td:not(:first-child) {
                min-width: 60px;
            }
            
            /* Color coding for different activities */
            .umhs { color: #1e3a8a; }
            .va { color: #166534; }
            .clinic { color: #92400e; }
            .anes { color: #5b21b6; }
            .research { color: #0e7490; }
            .orientation { color: #ea580c; background-color: #fef3c7; padding: 0 0.125rem; border-radius: 0.125rem; }
            .holiday { font-size: 0.75rem; line-height: 1; }
            
            /* Row stripes */
            tbody tr:nth-child(odd) { background-color: #ffffff; }
            tbody tr:nth-child(even) { background-color: var(--mizzou-gray-row); }
            tbody tr:nth-child(odd) td:first-child { background-color: #ffffff; }
            tbody tr:nth-child(even) td:first-child { background-color: var(--mizzou-gray-row); }
        }
        
        /* Loading states */
        .loading, .no-data {
            text-align: center;
            padding: 2rem;
            color: #6b7280;
        }
        .hidden {
            display: none;
        }
        
        /* Navigation buttons */
        .nav-buttons {
            display: flex;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }
        .nav-btn {
            padding: 0.375rem 0.75rem;
            background: #e5e7eb;
            border: none;
            border-radius: 0.25rem;
            font-size: 0.75rem;
            cursor: pointer;
        }
        .nav-btn:active {
            background: #d1d5db;
        }
    </style>
</head>
<body class="p-2 md:p-8">
    <div class="container mx-auto max-w-6xl">
        <header class="mizzou-header">
            <h1 class="text-xl md:text-3xl font-bold">Weekly Schedule</h1>
            <p class="text-xs md:text-base">Mizzou Gastroenterology</p>
        </header>

        <div class="controls">
            <select id="week-select" class="w-full md:w-auto">
                <!-- Options populated by JavaScript -->
            </select>
            <div class="nav-buttons">
                <button id="prev-week" class="nav-btn">‚Üê Prev</button>
                <button id="next-week" class="nav-btn">Next ‚Üí</button>
            </div>
        </div>

        <div id="schedule-container" class="table-container">
            <div id="loading-message" class="loading hidden">Loading schedule...</div>
            <div id="no-data-message" class="no-data hidden">No schedule data available for this week.</div>
            <table id="schedule-table">
                <thead id="table-header">
                    <!-- Headers populated by JavaScript -->
                </thead>
                <tbody id="table-body">
                    <!-- Data populated by JavaScript -->
                </tbody>
            </table>
        </div>
    </div>

    <script>
        // Only abbreviations used:
        // - Orientation ‚Üí Ori
        // - Holiday (any) ‚Üí üéÜ
        // All other rotation names remain in full

        // Sun and moon indicators for AM/PM
        const AM_INDICATOR = '‚òÄ';
        const PM_INDICATOR = '‚òΩ';
        
        // Special formatting for holidays and orientation only
        function formatSpecialContent(text) {
            if (!text) return text;
            const lower = text.toLowerCase();
            // Use emoji only for any holiday
            if (lower.includes('holiday')) return 'üéÜ';
            // Abbreviate orientation
            if (lower === 'orientation') return 'Ori';
            return text;
        }

        // Get CSS class for activity type
        function getActivityClass(content) {
            if (!content) return '';
            const lower = content.toLowerCase();
            if (lower.includes('umhs')) return 'umhs';
            if (lower.includes('va')) return 'va';
            if (lower.includes('eod')) return 'clinic';
            if (lower.includes('cc/') || lower.includes('amb/')) return 'clinic';
            if (lower.includes('anes')) return 'anes';
            if (lower.includes('research')) return 'research';
            if (lower.includes('orientation')) return 'orientation';
            if (lower.includes('holiday')) return 'holiday';
            if (lower.includes('vacation')) return 'vacation';
            return '';
        }

        let currentWeekFile = '';

        // Generate weeks
        function generateWeeks() {
            const weeks = [];
            let currentDate = new Date(2025, 5, 30);
            const endDate = new Date(2026, 5, 26);

            while (currentDate <= endDate) {
                const weekStart = new Date(currentDate);
                const weekEnd = new Date(currentDate);
                weekEnd.setDate(weekEnd.getDate() + 4);
                
                const formatDate = (date, includeYear) => {
                    const month = date.getMonth() + 1;
                    const day = date.getDate();
                    const year = date.getFullYear();
                    if (includeYear) {
                        return `${month}/${day}/${year.toString().slice(-2)}`;
                    }
                    return `${month}/${day}`;
                };
                
                const startYear = weekStart.getFullYear();
                const endYear = weekEnd.getFullYear();
                const includeEndYear = startYear !== endYear;
                
                const weekString = `${formatDate(weekStart, false)}-${formatDate(weekEnd, includeEndYear)}`;
                const fileName = `week_${(weekStart.getMonth() + 1)}_${weekStart.getDate()}_${weekStart.getFullYear().toString().slice(-2)}.csv`;
                
                weeks.push({
                    display: weekString,
                    file: fileName,
                    startDate: new Date(weekStart)
                });
                
                currentDate.setDate(currentDate.getDate() + 7);
            }
            
            return weeks;
        }

        // Get current week
        function getCurrentWeek(weeks) {
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            for (let i = 0; i < weeks.length; i++) {
                const weekStart = new Date(weeks[i].startDate);
                const weekEnd = new Date(weekStart);
                weekEnd.setDate(weekEnd.getDate() + 4);
                
                if (today >= weekStart && today <= weekEnd) {
                    return i;
                }
            }
            return 0;
        }

        // Parse CSV
        function parseCSV(csvText) {
            const lines = csvText.trim().split('\n');
            if (lines.length === 0) return null;

            const rawHeaders = lines[0].split(',').map(h => h.trim());
            const headers = [];
            const counts = {};
            rawHeaders.forEach(h => {
                if (counts[h]) {
                    counts[h] += 1;
                    headers.push(`${h}${counts[h]}`);
                } else {
                    counts[h] = 1;
                    headers.push(h);
                }
            });

            const data = [];
            for (let i = 1; i < lines.length; i++) {
                const values = lines[i].split(',').map(v => v.trim());
                const row = {};
                headers.forEach((header, index) => {
                    row[header] = values[index] || '';
                });
                data.push(row);
            }

            return { headers, data };
        }

        // Create table headers
        function createTableHeaders(startDate) {
            const isMobile = window.innerWidth <= 650;
            const days = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri'];
            
            const dates = days.map((_, idx) => {
                const d = new Date(startDate);
                d.setDate(d.getDate() + idx);
                return `${d.getMonth() + 1}/${d.getDate()}`;
            });

            const headerHtml = `
                <tr>
                    <th>Name</th>
                    ${days.map((day, i) => `
                        <th class="day-header">
                            ${day}
                            ${isMobile ? `<br><span class="date-label">${dates[i]}</span>` : ` ${dates[i]}`}
                        </th>
                    `).join('')}
                </tr>
            `;
            return headerHtml;
        }

        // Style cell content
        function styleCellContent(amContent, pmContent) {
            const amClass = getActivityClass(amContent);
            const pmClass = getActivityClass(pmContent);
            const amText = formatSpecialContent(amContent) || '-';
            const pmText = formatSpecialContent(pmContent) || '-';

            const isMobile = window.innerWidth <= 650;

            if (isMobile) {
                // Special case: if both AM and PM are the same holiday emoji, show it centered
                if (amText === 'üéÜ' && pmText === 'üéÜ') {
                    return `
                        <div class="shift-cell">
                            <div class="holiday" style="text-align: center; padding: 0.125rem 0; font-size: 0.625rem;">
                                üéÜ
                            </div>
                        </div>
                    `;
                }

                return `
                    <div class="shift-cell">
                        <div class="am-shift ${amClass}">
                            <span class="time-indicator am-indicator">${AM_INDICATOR}</span>
                            ${amText}
                        </div>
                        <div class="shift-divider"></div>
                        <div class="pm-shift ${pmClass}">
                            <span class="time-indicator pm-indicator">${PM_INDICATOR}</span>
                            ${pmText}
                        </div>
                    </div>
                `;
            }

            // Normal desktop view without AM/PM icons
            return `
                <div class="shift-cell">
                    <div class="am-shift ${amClass}">${amText}</div>
                    <div class="shift-divider"></div>
                    <div class="pm-shift ${pmClass}">${pmText}</div>
                </div>
            `;
        }

        // Sample data for week_6_30_25.csv
        const sampleData = {
            'week_6_30_25.csv': `NAME,PGY,AM,PM,AM,PM,AM,PM,AM,PM,AM,PM
Tarar,6,UMHS-2,UMHS-2,UMHS-2,UMHS-2,UMHS-2,VA1,UMHS-2,UMHS-2,Holiday (4th of July),Holiday (4th of July)
Mansour,6,EOD1,CC/JB,Priv Anes,Priv Anes,EOD1,Research,Priv Anes,Priv Anes,Holiday (4th of July),Holiday (4th of July)
Deda,6,VA2,CC/VA2,VA2,VA2,VA2,VA2,VA2,VA2,Holiday (4th of July),Holiday (4th of July)
Fard,5,VA1,VA1,VA1,VA1,VA1,CC/PC,VA1,VA1,Holiday (4th of July),Holiday (4th of July)
Gandhi,5,UMHS-1,CC/VA3,UMHS-1,UMHS-1,UMHS-1,UMHS-1,UMHS-1,UMHS-1,Holiday (4th of July),Holiday (4th of July)
Islam,5,VA3,Amb/JB,Research,Research,Amb/PC,CC/PC,Research,Research,Holiday (4th of July),Holiday (4th of July)
Ali,4,Orientation,Orientation,Orientation,Orientation,Orientation,Orientation,Orientation,Orientation,Holiday (4th of July),Holiday (4th of July)
Merchant,4,Orientation,Orientation,Orientation,Orientation,Orientation,Orientation,Orientation,Orientation,Holiday (4th of July),Holiday (4th of July)
Zaher,4,Orientation,Orientation,Orientation,Orientation,Orientation,Orientation,Orientation,Orientation,Holiday (4th of July),Holiday (4th of July)
Mahdi,4,Orientation,Orientation,Orientation,Orientation,Orientation,Orientation,Orientation,Orientation,Holiday (4th of July),Holiday (4th of July)`
        };

        // Load schedule
        async function loadSchedule(weekFile, startDate) {
            currentWeekFile = weekFile;
            const isMobile = window.innerWidth <= 650;
            const loadingMsg = document.getElementById('loading-message');
            const noDataMsg = document.getElementById('no-data-message');
            const table = document.getElementById('schedule-table');
            const tableHeader = document.getElementById('table-header');
            const tableBody = document.getElementById('table-body');
            
            loadingMsg.classList.remove('hidden');
            noDataMsg.classList.add('hidden');
            table.style.display = 'none';
            
            try {
                let csvText;
                
                // Use sample data if available, otherwise try to fetch
                if (sampleData[weekFile]) {
                    csvText = sampleData[weekFile];
                } else {
                    const response = await fetch(weekFile);
                    if (!response.ok) throw new Error('File not found');
                    csvText = await response.text();
                }
                
                const parsedData = parseCSV(csvText);
                
                if (!parsedData || parsedData.data.length === 0) {
                    throw new Error('No data');
                }
                
                tableHeader.innerHTML = createTableHeaders(startDate);

                // Create rows
                const rowsHtml = parsedData.data.map(row => {
                    const name = row.NAME || '';
                    const pgy = row.PGY || '';
                    const nameCell = isMobile 
                        ? `<td>${name}<span class="pgy">${pgy ? `-${pgy}` : ''}</span></td>`
                        : `<td>${name}<span class="pgy-badge">PGY-${pgy}</span></td>`;
                    
                    const cells = [nameCell];
                    
                    // Add day cells
                    for (let d = 0; d < 5; d++) {
                        const amKey = d === 0 ? 'AM' : `AM${d + 1}`;
                        const pmKey = d === 0 ? 'PM' : `PM${d + 1}`;
                        const amContent = row[amKey] || '';
                        const pmContent = row[pmKey] || '';
                        
                        cells.push(`<td>${styleCellContent(amContent, pmContent)}</td>`);
                    }
                    
                    return `<tr>${cells.join('')}</tr>`;
                }).join('');
                
                tableBody.innerHTML = rowsHtml;
                loadingMsg.classList.add('hidden');
                table.style.display = 'table';
                
            } catch (error) {
                loadingMsg.classList.add('hidden');
                noDataMsg.classList.remove('hidden');
                table.style.display = 'none';
            }
        }

        // Initialize
        function init() {
            const weekSelect = document.getElementById('week-select');
            const prevBtn = document.getElementById('prev-week');
            const nextBtn = document.getElementById('next-week');
            const weeks = generateWeeks();
            
            weeks.forEach((week, index) => {
                const option = document.createElement('option');
                option.value = week.file;
                option.textContent = week.display;
                option.dataset.index = index;
                weekSelect.appendChild(option);
            });
            
            let currentWeekIndex = getCurrentWeek(weeks);
            weekSelect.selectedIndex = currentWeekIndex;
            
            loadSchedule(weekSelect.value, weeks[currentWeekIndex].startDate);
            
            weekSelect.addEventListener('change', (e) => {
                currentWeekIndex = e.target.selectedIndex;
                loadSchedule(e.target.value, weeks[currentWeekIndex].startDate);
            });

            prevBtn.addEventListener('click', () => {
                if (currentWeekIndex > 0) {
                    currentWeekIndex -= 1;
                    weekSelect.selectedIndex = currentWeekIndex;
                    weekSelect.dispatchEvent(new Event('change'));
                }
            });

            nextBtn.addEventListener('click', () => {
                if (currentWeekIndex < weeks.length - 1) {
                    currentWeekIndex += 1;
                    weekSelect.selectedIndex = currentWeekIndex;
                    weekSelect.dispatchEvent(new Event('change'));
                }
            });
            
            // Reload on window resize to adjust for mobile/desktop
            let resizeTimer;
            window.addEventListener('resize', () => {
                clearTimeout(resizeTimer);
                resizeTimer = setTimeout(() => {
                    loadSchedule(weekSelect.value, weeks[currentWeekIndex].startDate);
                }, 250);
            });
        }

        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
