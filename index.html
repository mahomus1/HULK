<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weekly Schedule - Mizzou GI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root {
            --mizzou-black: #000000;
            --mizzou-gold: #FFB612;
            --mizzou-gold-dark: #C99700;
            --mizzou-gray: #f8f8f8;
            --mizzou-gray-row: #f2f2f2;
            --mizzou-hover-gold: #FFF8E1;
        }
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--mizzou-gray);
        }
        .mizzou-header {
            background-color: var(--mizzou-black);
            color: var(--mizzou-gold);
            padding: 1rem;
            border-radius: 0.5rem;
            margin-bottom: 1.5rem;
            text-align: center;
        }
        .mizzou-header h1,
        .mizzou-header p {
            color: var(--mizzou-gold);
        }
        .mizzou-footer {
            background-color: var(--mizzou-black);
            color: var(--mizzou-gold);
            padding: 1rem;
            border-radius: 0.5rem;
            margin-top: 2rem;
            text-align: center;
        }
        .controls {
            background-color: #ffffff;
            padding: 1.5rem;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            margin-bottom: 1.5rem;
        }
        select {
            padding: 0.5rem 0.75rem;
            font-size: 1rem;
            border-radius: 0.375rem;
            border: 1px solid #d1d5db;
            background-color: white;
            cursor: pointer;
        }
        .table-container {
            background-color: white;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            overflow-x: auto;
            max-height: 75vh;
            overflow-y: auto;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 750px;
        }
        th, td {
            padding: 0.25rem 0.5rem;
            text-align: left;
            border-bottom: 1px solid #e5e7eb;
            font-size: 0.875rem;
        }
        th {
            background-color: var(--mizzou-black);
            color: var(--mizzou-gold);
            font-weight: 600;
            position: sticky;
            top: 0;
            z-index: 10;
            white-space: nowrap;
        }
        /* Sticky first column (NAME) */
        thead th:nth-child(1) {
            position: sticky;
            left: 0;
            z-index: 12;
            background-color: var(--mizzou-black);
        }
        tbody td:nth-child(1) {
            position: sticky;
            left: 0;
            background-color: white;
            z-index: 5;
            font-weight: 600;
            min-width: 120px;
            max-width: 120px;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        /* Row styling */
        tr:nth-child(even) { background-color: var(--mizzou-gray-row); }
        tr:nth-child(odd) { background-color: #ffffff; }
        tr:hover { background-color: var(--mizzou-hover-gold); }
        
        /* Ensure sticky columns maintain row colors */
        tr:nth-child(odd) td:nth-child(1) { background-color: #ffffff; }
        tr:nth-child(even) td:nth-child(1) { background-color: var(--mizzou-gray-row); }
        tr:hover td:nth-child(1) { background-color: var(--mizzou-hover-gold); }
        
        /* Time slot headers */
        .day-header {
            text-align: center;
            font-weight: 700;
            background-color: var(--mizzou-gold) !important;
            color: var(--mizzou-black) !important;
        }
        .time-header {
            text-align: center;
            background-color: var(--mizzou-black);
            color: var(--mizzou-gold);
        }
        .pgy-badge {
            background-color: var(--mizzou-gold-dark);
            color: var(--mizzou-black);
            padding: 0.125rem 0.25rem;
            border-radius: 0.25rem;
            font-size: 0.75rem;
            margin-left: 0.25rem;
        }
        /* Add vertical dividers between days */
        .day-divider {
            border-right: 2px solid #e5e7eb !important;
        }
        .am-pm-separator {
            border: none;
            border-top: 1px solid #e5e7eb;
            margin: 0.125rem 0;
        }
        .slot-indicator {
            font-weight: 600;
            font-size: 0.6rem;
            color: var(--mizzou-black);
        }
        /* Cell content styling */
        td {
            text-align: center;
        }
        .vacation-cell {
            color: #9ca3af;
            font-style: italic;
            font-weight: 400;
        }
        .research-cell {
            color: #059669;
            font-weight: 600;
        }

        /* Orientation cell styling */
        .orientation-cell {
            background-color: #fef9c3;
            color: #92400e;
            font-weight: 500;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
        }

        /* General holiday cell styling */
        .holiday-cell {
            background: linear-gradient(45deg, #e0e7ff 0%, #c7d2fe 100%);
            color: #4c1d95;
            font-weight: 600;
            padding: 0.5rem;
            border-radius: 0.375rem;
            position: relative;
        }

        /* 4th of July specific styling */
        .july4-cell {
            background-color: #eff6ff;
            color: #1e3a8a;
            font-weight: 500;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
        }
        .no-data {
            text-align: center;
            padding: 3rem;
            color: #6b7280;
            font-size: 1.125rem;
        }
        /* Mobile responsiveness */
        @media (max-width: 768px) {
            th, td {
                padding: 0.0625rem;
                font-size: 0.625rem;
            }
            .controls {
                padding: 0.5rem;
            }
            tbody td:nth-child(1) {
                min-width: 40px;
                max-width: 40px;
                overflow: hidden;
                text-overflow: ellipsis;
            }
            thead th:nth-child(1) {
                min-width: 40px;
            }
            table {
                min-width: 600px;
            }
            .pgy-badge {
                font-size: 0.5rem;
                padding: 0.0625rem 0.125rem;
                margin-left: 0.125rem;
            }
            .slot-indicator {
                font-size: 0.45rem;
            }
            .orientation-cell,
            .holiday-cell,
            .july4-cell {
                font-size: 0.625rem;
                padding: 0.25rem;
            }
        }
        @media (max-width: 480px) {
            .pgy-badge {
                display: none;
            }
        }
        /* Loading spinner */
        .loading {
            text-align: center;
            padding: 2rem;
            color: #6b7280;
        }
        .hidden {
            display: none;
        }
    </style>
</head>
<body class="p-4 md:p-8">
    <div class="container mx-auto">
        <header class="mizzou-header">
            <img src="https://raw.githubusercontent.com/hfg-gmuend/openmoji/master/color/svg/E313.svg" alt="GI Logo" class="w-24 h-24 mx-auto mb-2">
            <h1 class="text-3xl sm:text-4xl font-bold">Weekly Schedule</h1>
            <p>Mizzou Division of Gastroenterology &amp; Hepatology</p>
        </header>

        <div class="controls">
            <div>
                <label for="week-select" class="block text-lg font-medium text-gray-700 mb-2">Select Week</label>
                <select id="week-select" class="w-full sm:w-auto">
                    <!-- Options will be populated by JavaScript -->
                </select>
            </div>
        </div>

        <div id="schedule-container" class="table-container">
            <div id="loading-message" class="loading hidden">Loading schedule...</div>
            <div id="no-data-message" class="no-data hidden">
                No schedule data available for this week.
            </div>
            <table id="schedule-table">
                <thead id="table-header">
                    <!-- Headers will be populated by JavaScript -->
                </thead>
                <tbody id="table-body">
                    <!-- Data will be populated by JavaScript -->
                </tbody>
            </table>
        </div>

        <footer class="mizzou-footer">
            <p>&copy; 2025 University of Missouri Gastroenterology Division</p>
        </footer>
    </div>

    <script>
        // Schedule data will be loaded from weekly CSV files
        
        // Expected CSV format:
        // NAME,PGY,AM,PM,AM,PM,AM,PM,AM,PM,AM,PM
        // (NAME, PGY, then Mon AM/PM, Tue AM/PM, Wed AM/PM, Thu AM/PM, Fri AM/PM)
        
        // File naming: week_M_D_YY.csv (e.g., week_6_30_25.csv)

        // Track current week for special holiday styling
        let currentWeekFile = '';
        
        // Generate all weeks from 6/30/2025 to 6/26/2026 (displayed Monday–Friday)
        function generateWeeks() {
            const weeks = [];
            let currentDate = new Date(2025, 5, 30); // June 30, 2025 (month is 0-indexed)
            const endDate = new Date(2026, 5, 26); // June 26, 2026

            while (currentDate <= endDate) {
                const weekStart = new Date(currentDate);
                const weekEnd = new Date(currentDate);
                // End of week is now Friday
                weekEnd.setDate(weekEnd.getDate() + 4);
                
                const formatDate = (date, includeYear) => {
                    const month = date.getMonth() + 1;
                    const day = date.getDate();
                    const year = date.getFullYear();
                    if (includeYear) {
                        return `${month}/${day}/${year.toString().slice(-2)}`;
                    }
                    return `${month}/${day}`;
                };
                
                const startYear = weekStart.getFullYear();
                const endYear = weekEnd.getFullYear();
                const includeEndYear = startYear !== endYear;
                
                const weekString = `${formatDate(weekStart, false)}-${formatDate(weekEnd, includeEndYear)}`;
                const fileName = `week_${(weekStart.getMonth() + 1)}_${weekStart.getDate()}_${weekStart.getFullYear().toString().slice(-2)}.csv`;
                
                weeks.push({
                    display: weekString,
                    file: fileName,
                    startDate: new Date(weekStart)
                });
                
                currentDate.setDate(currentDate.getDate() + 7);
            }
            
            return weeks;
        }

        // Get current week
        function getCurrentWeek(weeks) {
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            for (let i = 0; i < weeks.length; i++) {
                const weekStart = new Date(weeks[i].startDate);
                const weekEnd = new Date(weekStart);
                // Current week spans Monday to Friday
                weekEnd.setDate(weekEnd.getDate() + 4);
                
                if (today >= weekStart && today <= weekEnd) {
                    return i;
                }
            }
            return 0; // Default to first week if current week not found
        }

        // Parse CSV data
        function parseCSV(csvText) {
            const lines = csvText.trim().split('\n');
            if (lines.length === 0) return null;

            const rawHeaders = lines[0].split(',').map(h => h.trim());
            const headers = [];
            const counts = {};
            rawHeaders.forEach(h => {
                if (counts[h]) {
                    counts[h] += 1;
                    headers.push(`${h}${counts[h]}`);
                } else {
                    counts[h] = 1;
                    headers.push(h);
                }
            });

            const data = [];

            for (let i = 1; i < lines.length; i++) {
                const values = lines[i].split(',').map(v => v.trim());
                const row = {};
                headers.forEach((header, index) => {
                    row[header] = values[index] || '';
                });
                data.push(row);
            }

            return { headers, data };
        }

        // Create table headers
function createTableHeaders(startDate, mobile = false) {
            const days = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday'];
            const labels = mobile ? days.map(d => d.slice(0, 3)) : days;
            const dates = days.map((_, idx) => {
                const d = new Date(startDate);
                d.setDate(d.getDate() + idx);
                return `${d.getMonth() + 1}/${d.getDate()}`;
            });

            if (mobile) {
                const headerHtml = `
                    <tr>
                        <th>NAME</th>
                        ${labels.map((day, i) => `<th class="day-header">${day}<br>${dates[i]}</th>`).join('')}
                    </tr>
                `;
                return headerHtml;
            }

            const headerHtml = `
                <tr>
                    <th rowspan="2">NAME</th>
                    ${days.map((day, i) => `<th colspan="2" class="day-header">${day}<br>${dates[i]}</th>`).join('')}
                </tr>
                <tr>
                    ${days.map((day, index) => {
                        const isDivider = index < days.length - 1;
                        return `<th class="time-header">AM</th><th class="time-header${isDivider ? ' day-divider' : ''}">PM</th>`;
                    }).join('')}
                </tr>
            `;
            return headerHtml;
}


        // Style cell content based on value
        function styleCellContent(content) {
            if (!content || content === '-' || content === '') return '-';

            const lowerContent = content.toLowerCase();

            // Check for orientation
            if (lowerContent === 'orientation') {
                return `<span class="orientation-cell">Orientation</span>`;
            }

            // Check for holidays
            if (lowerContent.includes('holiday')) {
                // Special case for 4th of July in the 6/30 week
                if (lowerContent.includes('4th of july') && currentWeekFile === 'week_6_30_25.csv') {
                    return `<span class="july4-cell">4th of July</span>`;
                }
                return `<span class="holiday-cell">${content}</span>`;
            }

            // Check for vacation
            if (lowerContent === 'vacation') {
                return `<span class="vacation-cell">${content}</span>`;
            }

            // Check for research
            if (lowerContent === 'research') {
                return `<span class="research-cell">${content}</span>`;
            }

            return content;
        }

        // Load and display schedule
        async function loadSchedule(weekFile, startDate) {
            currentWeekFile = weekFile; // Track current week for special styling
            const mobile = window.matchMedia('(max-width: 768px)').matches;
            const loadingMsg = document.getElementById('loading-message');
            const noDataMsg = document.getElementById('no-data-message');
            const table = document.getElementById('schedule-table');
            const tableHeader = document.getElementById('table-header');
            const tableBody = document.getElementById('table-body');
            
            // Show loading
            loadingMsg.classList.remove('hidden');
            noDataMsg.classList.add('hidden');
            table.style.display = 'none';
            
            try {
                const response = await fetch(weekFile);
                if (!response.ok) {
                    throw new Error('File not found');
                }
                
                const csvText = await response.text();
                const parsedData = parseCSV(csvText);
                
                if (!parsedData || parsedData.data.length === 0) {
                    throw new Error('No data');
                }
                
                // Create headers with dates for each day
                tableHeader.innerHTML = createTableHeaders(startDate, mobile);

                // Create rows
                const rowsHtml = parsedData.data.map(row => {
                    const nameCell = `<td class="text-left">${row.NAME || ''}<span class="pgy-badge">PGY-${row.PGY || ''}</span></td>`;
                    const cells = [nameCell];

                    if (mobile) {
                        for (let d = 0; d < 5; d++) {
                            const am = row[d === 0 ? 'AM' : `AM${d + 1}`] || '';
                            const pm = row[d === 0 ? 'PM' : `PM${d + 1}`] || '';
                            const isDivider = d < 4;
                            cells.push(`
                                <td${isDivider ? ' class="day-divider"' : ''}>
                                    <span class="slot-indicator">☀️</span> ${styleCellContent(am)}
                                    <hr class="am-pm-separator">
                                    <span class="slot-indicator">🌙</span> ${styleCellContent(pm)}
                                </td>`);
                        }
                    } else {
                        // Add AM/PM slots (skip NAME and PGY columns)
                        for (let i = 2; i < parsedData.headers.length; i++) {
                            const content = row[parsedData.headers[i]] || '';
                            const cellIndex = i - 2;
                            const isDivider = cellIndex % 2 === 1 && cellIndex < parsedData.headers.length - 4;
                            cells.push(`<td${isDivider ? ' class="day-divider"' : ''}>${styleCellContent(content)}</td>`);
                        }
                    }

                    return `<tr>${cells.join('')}</tr>`;
                }).join('');
                
                tableBody.innerHTML = rowsHtml;
                
                // Show table
                loadingMsg.classList.add('hidden');
                table.style.display = 'table';
                
            } catch (error) {
                // Show no data message
                loadingMsg.classList.add('hidden');
                noDataMsg.classList.remove('hidden');
                table.style.display = 'none';
            }
        }


        // Initialize the application
        function init() {
            const weekSelect = document.getElementById('week-select');
            const weeks = generateWeeks();
            
            // Populate dropdown
            weeks.forEach((week, index) => {
                const option = document.createElement('option');
                option.value = week.file;
                option.textContent = week.display;
                option.dataset.index = index;
                weekSelect.appendChild(option);
            });
            
            // Set current week
            const currentWeekIndex = getCurrentWeek(weeks);
            weekSelect.selectedIndex = currentWeekIndex;
            
            // Load the schedule for the selected week
            loadSchedule(weekSelect.value, weeks[currentWeekIndex].startDate);
            
            // Handle week selection change
            weekSelect.addEventListener('change', (e) => {
                loadSchedule(e.target.value, weeks[e.target.selectedIndex].startDate);
            });
        }


        // Run on page load
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
